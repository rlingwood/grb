from astropy.io import fits
import matplotlib.pyplot as plt
import numpy as np

xsections = fits.getdata('IsmabsAtomicData_reduced.fits',1)

ISMabund = {'H':12.0,'He':10.99,'C':8.38,'N':7.88,'O':8.69,'Fe':7.43,'Ne':7.94,'Mg':7.40,'Si':7.27,'S':7.09,'Ar':6.41,'Ca':6.20}
beta = {'H':1.0,'He':1.0,'C':0.5,'N':1.0,'O':0.6,'Fe':0.3,'Ne':1.0,'Mg':0.2,'Si':0.1,'S':0.6,'Ar':1.0,'Ca':0.003}

H = xsections['H']*10.**(ISMabund['H']-12)#*beta['H']
He = xsections['HeI']*10.**(ISMabund['He']-12)#*beta['He']
C = xsections['CI']*10.**(ISMabund['C']-12)#*beta['C']
N = xsections['NI']*10.**(ISMabund['N']-12)#*beta['N']
O = xsections['OI']*10.**(ISMabund['O']-12)#%*beta['O']
Fe = xsections['FeI']*10.**(ISMabund['Fe']-12)#*beta['Fe']
Ne = xsections['NeI']*10.**(ISMabund['Ne']-12)#*beta['Ne']
Mg = xsections['MgI']*10.**(ISMabund['Mg']-12)#*beta['Mg']
Si = xsections['SiI']*10.**(ISMabund['Si']-12)#*beta['Si']
S = xsections['SI']*10.**(ISMabund['S']-12)#*beta['S']
Ar = xsections['ArI']*10.**(ISMabund['Ar']-12)#*beta['Ar']
Ca = xsections['CaI']*10.**(ISMabund['Ca']-12)#*beta['Ca']
keV = xsections['Energy']/1000.

totsigma = (H+He+C+O+Fe+Ne+Mg+Si+S+Ar+Ca)*1e24

dE = 0.1
E = np.arange(0.5, 10, 0.1)
sigma = np.zeros(95)

def attenuation(e):
     index = np.where((keV<e+dE) & (keV>e))
     s = totsigma[index[0]]
     return s[0]
 
n = 0
for i in E:
    sigma[n] = attenuation(i)
    n = n+1
    
nh = 1
beta = -1
intrinsic = E**beta
y = intrinsic*np.e**(-1*sigma*nh)
plt.loglog(E, y, c='k', lw=1)
